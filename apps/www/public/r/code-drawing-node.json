{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "code-drawing-node",
  "type": "registry:ui",
  "title": "Code Drawing Node",
  "description": "Create diagrams from code using PlantUML, Graphviz, Flowchart, or Mermaid.",
  "dependencies": [
    "@platejs/code-drawing"
  ],
  "registryDependencies": [
    "popover",
    "button",
    "select"
  ],
  "files": [
    {
      "path": "src/registry/ui/code-drawing-node.tsx",
      "content": "'use client';\n\nimport * as React from 'react';\n\nimport { CodeDrawingElement as BaseCodeDrawingElement } from '@platejs/code-drawing/react';\nimport type { CodeDrawingType, TCodeDrawingElement, ViewMode } from '@platejs/code-drawing';\nimport type { PlateElementProps } from 'platejs/react';\nimport {\n  useEditorRef,\n  useEditorSelector,\n  useElement,\n  useFocusedLast,\n  useReadOnly,\n  useSelected,\n} from 'platejs/react';\nimport { Trash2, DownloadIcon } from 'lucide-react';\n\nimport { useIsMobile } from '@/hooks/use-mobile';\nimport { Button } from '@/components/ui/button';\nimport {\n  Popover,\n  PopoverAnchor,\n  PopoverContent,\n} from '@/components/ui/popover';\nimport { useCodeDrawingElement } from '@platejs/code-drawing/react';\nimport { downloadImage } from '@platejs/code-drawing';\nimport { DOWNLOAD_FILENAME } from '@platejs/code-drawing';\n\nimport { CodeDrawingPreview } from './code-drawing-preview';\n\nexport function CodeDrawingElement(\n  props: PlateElementProps<TCodeDrawingElement>\n) {\n  const isMobile = useIsMobile();\n  const editor = useEditorRef();\n  const readOnly = useReadOnly();\n  const selected = useSelected();\n  const isFocusedLast = useFocusedLast();\n  const element = useElement<TCodeDrawingElement>();\n  const { removeNode, image, loading } = useCodeDrawingElement({ element });\n\n  const handleDownload = React.useCallback(() => {\n    if (!image) return;\n    downloadImage(image, DOWNLOAD_FILENAME);\n  }, [image]);\n\n  const handleCodeChange = React.useCallback(\n    (code: string) => {\n      const path = editor.api.findPath(element);\n      if (path) {\n        editor.tf.setNodes(\n          {\n            data: {\n              ...element.data,\n              code,\n            },\n          },\n          { at: path }\n        );\n      }\n    },\n    [editor, element]\n  );\n\n  const handleDrawingTypeChange = React.useCallback(\n    (drawingType: CodeDrawingType) => {\n      const path = editor.api.findPath(element);\n      if (path) {\n        editor.tf.setNodes(\n          {\n            data: {\n              ...element.data,\n              drawingType,\n            },\n          },\n          { at: path }\n        );\n      }\n    },\n    [editor, element]\n  );\n\n  const handleDrawingModeChange = React.useCallback(\n    (drawingMode: ViewMode) => {\n      const path = editor.api.findPath(element);\n      if (path) {\n        editor.tf.setNodes(\n          {\n            data: {\n              ...element.data,\n              drawingMode,\n            },\n          },\n          { at: path }\n        );\n      }\n    },\n    [editor, element]\n  );\n\n  const code = element.data?.code ?? '';\n  const drawingType = element.data?.drawingType ?? 'Mermaid';\n  const drawingMode = element.data?.drawingMode ?? 'Both';\n\n  const selectionCollapsed = useEditorSelector(\n    (editor) => !editor.api.isExpanded(),\n    []\n  );\n\n  const open = isFocusedLast && !readOnly && selected && selectionCollapsed;\n\n  const content = (\n    <BaseCodeDrawingElement {...props}>\n      <div contentEditable={false}>\n        <CodeDrawingPreview\n          code={code}\n          drawingType={drawingType}\n          drawingMode={drawingMode}\n          image={image}\n          loading={loading}\n          onCodeChange={handleCodeChange}\n          onDrawingTypeChange={handleDrawingTypeChange}\n          onDrawingModeChange={handleDrawingModeChange}\n          readOnly={readOnly}\n          isMobile={isMobile}\n        />\n      </div>\n    </BaseCodeDrawingElement>\n  );\n\n  if (readOnly) {\n    return content;\n  }\n\n  return (\n    <Popover open={open} modal={false}>\n      <PopoverAnchor asChild>{content}</PopoverAnchor>\n      <PopoverContent\n        className=\"w-auto p-1\"\n        contentEditable={false}\n        onOpenAutoFocus={(e) => e.preventDefault()}\n      >\n        <div className=\"flex items-center gap-1\">\n          {image && (\n            <Button\n              size=\"icon\"\n              variant=\"ghost\"\n              className=\"size-8\"\n              onClick={handleDownload}\n              title=\"Export\"\n            >\n              <DownloadIcon className=\"size-4\" />\n            </Button>\n          )}\n          <Button\n            size=\"icon\"\n            variant=\"ghost\"\n            className=\"size-8\"\n            onClick={removeNode}\n            title=\"Delete\"\n          >\n            <Trash2 className=\"size-4\" />\n          </Button>\n        </div>\n      </PopoverContent>\n    </Popover>\n  );\n}\n",
      "type": "registry:ui"
    },
    {
      "path": "src/registry/ui/code-drawing-node-static.tsx",
      "content": "import * as React from 'react';\n\nimport type { TCodeDrawingElement } from '@platejs/code-drawing';\nimport type { SlateElementProps } from 'platejs/static';\n\nimport { SlateElement } from 'platejs/static';\n\nexport function CodeDrawingElementStatic({\n  children,\n  ...props\n}: SlateElementProps<TCodeDrawingElement>) {\n  return (\n    <SlateElement className=\"my-4 flex w-full items-stretch\" {...props}>\n      <div className=\"flex w-full flex-col md:flex-row\">\n        <div className=\"relative h-full min-w-0 flex-1 rounded-md bg-muted/50 p-8 pr-4\">\n          <pre className=\"m-0 overflow-x-auto font-mono text-sm leading-[normal] [tab-size:2] print:break-inside-avoid\">\n            <code className=\"block w-full\">\n              {(props.element.data?.code as string) ||\n                'Enter your code here...'}\n            </code>\n          </pre>\n        </div>\n        <div className=\"relative flex min-w-0 flex-1 items-center justify-center rounded-md border bg-muted/30 p-4\">\n          <div className=\"text-muted-foreground\">\n            {props.element.data?.drawingType || 'Mermaid'}\n          </div>\n        </div>\n      </div>\n      {children}\n    </SlateElement>\n  );\n}\n",
      "type": "registry:ui"
    }
  ],
  "meta": {
    "docs": [
      {
        "route": "/docs/code-drawing"
      },
      {
        "route": "https://pro.platejs.org/docs/components/code-drawing-node"
      }
    ],
    "examples": [
      "code-drawing-demo"
    ]
  }
}